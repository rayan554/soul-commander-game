<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Soul Commander - Pixel Command RPG</title>
    <meta name="description" content="Text-based RPG dengan pixel art. Kendalikan pahlawan dengan perintah teks!">
    <meta name="theme-color" content="#6C5CE7">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚öîÔ∏è</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Mobile Web App Capable -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="pixel-logo">‚öîÔ∏è</div>
                <h1>SOUL COMMANDER</h1>
                <div class="loading-subtitle">Pixel Command RPG v2.1</div>
            </div>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loadingBar"></div>
            </div>
            <div class="loading-tip" id="loadingTip">Optimizing for your device...</div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="game-container" id="gameContainer" style="display: none;">
        <!-- Game Header -->
        <header class="game-header">
            <div class="header-left">
                <div class="game-title">
                    <span class="title-icon">‚öîÔ∏è</span>
                    <h1>SOUL COMMANDER</h1>
                </div>
                <div class="game-version">v2.1</div>
            </div>
            
            <div class="header-right">
                <div class="online-status" id="onlineStatus">
                    <span class="status-dot">‚óè</span>
                    <span id="connectionText">Online</span>
                </div>
                <button class="menu-btn" id="menuBtn" onclick="toggleGameMenu()" aria-label="Menu" title="Menu">
                    <span class="menu-icon">‚ò∞</span>
                </button>
            </div>
        </header>

        <!-- Dropdown Menu -->
        <div class="dropdown-menu" id="gameMenu">
            <button class="menu-item" onclick="gameSave()">
                <span class="menu-icon">üíæ</span> Save Game
            </button>
            <button class="menu-item" onclick="gameLoad()">
                <span class="menu-icon">üìÇ</span> Load Game
            </button>
            <button class="menu-item" onclick="toggleGameSound()" id="soundToggleBtn">
                <span class="menu-icon">üîä</span> Sound: ON
            </button>
            <button class="menu-item" onclick="exportGameData()">
                <span class="menu-icon">üì§</span> Export Data
            </button>
            <button class="menu-item" onclick="showGameHelp()">
                <span class="menu-icon">‚ùì</span> Help & Commands
            </button>
            <button class="menu-item" onclick="toggleFullscreenMode()">
                <span class="menu-icon">‚õ∂</span> Fullscreen
            </button>
            <button class="menu-item reset-btn" onclick="resetGameData()">
                <span class="menu-icon">üîÑ</span> Reset Game
            </button>
        </div>

        <!-- Main Game Area -->
        <div class="game-area" id="gameArea">
            <!-- Left Column: Character & Stats -->
            <div class="left-column" id="leftColumn">
                <!-- Character Display -->
                <div class="character-section">
                    <div class="character-title">
                        <span class="section-icon">üë§</span>
                        SOUL COMMANDER
                    </div>
                    
                    <div class="character-display">
                        <canvas id="characterCanvas" width="128" height="128"></canvas>
                        <div class="character-info">
                            <div class="char-name" id="charName">Knight</div>
                            <div class="char-class" id="charClass">‚öîÔ∏è Warrior</div>
                            <div class="char-level">Level <span id="charLevel">1</span></div>
                        </div>
                    </div>

                    <!-- Stats Bars -->
                    <div class="stats-container">
                        <div class="stat-item">
                            <div class="stat-header">
                                <span class="stat-icon">‚ù§Ô∏è</span>
                                <span class="stat-label">HEALTH</span>
                                <span class="stat-value" id="healthValue">100/100</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-fill health-fill" id="healthBar" style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-header">
                                <span class="stat-icon">üîÆ</span>
                                <span class="stat-label">MANA</span>
                                <span class="stat-value" id="manaValue">50/50</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-fill mana-fill" id="manaBar" style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-header">
                                <span class="stat-icon">‚≠ê</span>
                                <span class="stat-label">EXPERIENCE</span>
                                <span class="stat-value" id="xpValue">0/100</span>
                            </div>
                            <div class="stat-bar">
                                <div class="bar-fill xp-fill" id="xpBar" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <span class="quick-icon">üí∞</span>
                                <span class="quick-label">Gold:</span>
                                <span class="quick-value" id="goldValue">1,250</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-icon">üéØ</span>
                                <span class="quick-label">Kills:</span>
                                <span class="quick-value" id="killsValue">0</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-icon">üìç</span>
                                <span class="quick-label">Area:</span>
                                <span class="quick-value" id="locationValue">Sanctuary</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-icon">üìÖ</span>
                                <span class="quick-label">Day:</span>
                                <span class="quick-value" id="gameDayValue">1</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipment Section -->
                <div class="equipment-section">
                    <div class="section-title">
                        <span class="section-icon">üéí</span>
                        EQUIPMENT
                    </div>
                    
                    <div class="equipment-grid">
                        <div class="equip-slot primary" onclick="useEquipmentItem('weapon')" data-slot="weapon">
                            <div class="slot-icon" id="weaponIcon">‚öîÔ∏è</div>
                            <div class="slot-label">Weapon</div>
                            <div class="slot-name" id="weaponName">Iron Sword</div>
                        </div>
                        
                        <div class="equip-slot secondary" onclick="useEquipmentItem('skill')" data-slot="skill">
                            <div class="slot-icon" id="skillIcon">üí•</div>
                            <div class="slot-label">Skill</div>
                            <div class="slot-name" id="skillName">Slam</div>
                        </div>
                        
                        <div class="equip-slot armor" onclick="useEquipmentItem('armor')" data-slot="armor">
                            <div class="slot-icon" id="armorIcon">üõ°Ô∏è</div>
                            <div class="slot-label">Armor</div>
                            <div class="slot-name" id="armorName">Leather</div>
                        </div>
                        
                        <div class="equip-slot accessory" onclick="useEquipmentItem('accessory')" data-slot="accessory">
                            <div class="slot-icon" id="accessoryIcon">üíé</div>
                            <div class="slot-label">Artifact</div>
                            <div class="slot-name" id="accessoryName">Crystal</div>
                        </div>
                        
                        <div class="equip-slot consumable" onclick="useEquipmentItem('potion')" data-slot="potion">
                            <div class="slot-icon" id="potionIcon">üß™</div>
                            <div class="slot-label">Potions</div>
                            <div class="slot-name" id="potionName">3x</div>
                        </div>
                        
                        <div class="equip-slot special" onclick="useEquipmentItem('special')" data-slot="special">
                            <div class="slot-icon" id="specialIcon">üêâ</div>
                            <div class="slot-label">Companion</div>
                            <div class="slot-name" id="specialName">Dragon</div>
                        </div>
                    </div>
                    
                    <div class="equipment-hint">
                        <span class="hint-icon">üí°</span>
                        Tap equipment to use
                    </div>
                </div>
            </div>

            <!-- Right Column: Game Log & Commands -->
            <div class="right-column" id="rightColumn">
                <!-- Game Log -->
                <div class="game-log-section">
                    <div class="log-header">
                        <div class="log-title">
                            <span class="section-icon">üìú</span>
                            SOUL CHRONICLE
                        </div>
                        <div class="log-controls">
                            <button class="log-btn" onclick="scrollLogToTop()" title="Scroll to top" id="scrollTopBtn">
                                ‚¨ÜÔ∏è
                            </button>
                            <button class="log-btn" onclick="toggleLogAutoScroll()" id="autoScrollBtn" title="Auto-scroll">
                                üîΩ
                            </button>
                            <button class="log-btn clear-btn" onclick="clearGameLog()" title="Clear log" id="clearLogBtn">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div class="log-container" id="gameLog">
                        <!-- Log entries will be added here by JavaScript -->
                        <div class="log-entry welcome">
                            <span class="log-time" id="logTime">[00:00]</span>
                            <span class="log-content">üåü WELCOME TO SOUL COMMANDER v2.1! üåü</span>
                        </div>
                        <div class="log-entry system">
                            <span class="log-time">[00:00]</span>
                            <span class="log-content">‚öîÔ∏è Your journey begins in the Sanctuary...</span>
                        </div>
                        <div class="log-entry system">
                            <span class="log-time">[00:00]</span>
                            <span class="log-content">üì± Mobile optimized ‚Ä¢ PWA ready ‚Ä¢ Offline play</span>
                        </div>
                        <div class="log-entry system">
                            <span class="log-time">[00:00]</span>
                            <span class="log-content">üí° Type commands or use quick actions below</span>
                        </div>
                    </div>
                    
                    <div class="log-footer">
                        <span class="log-counter" id="logCounter">4/100 messages</span>
                        <span class="log-hint" id="logHint">‚Üì Auto-scroll ON ‚Ä¢ Tap log to focus input</span>
                    </div>
                </div>

                <!-- Command Input -->
                <div class="command-section">
                    <div class="command-header">
                        <div class="command-title">
                            <span class="section-icon">‚å®Ô∏è</span>
                            COMMAND TERMINAL
                        </div>
                        <button class="mobile-help-btn" onclick="showMobileTipsModal()" title="Mobile tips" id="mobileHelpBtn">
                            üì±
                        </button>
                    </div>
                    
                    <div class="command-input-group">
                        <div class="input-wrapper">
                            <div class="command-prefix">&gt;</div>
                            <input type="text" 
                                   id="commandInput" 
                                   class="command-input" 
                                   placeholder="Type command here..."
                                   enterkeyhint="send"
                                   inputmode="text"
                                   autocapitalize="none"
                                   autocomplete="off"
                                   spellcheck="false"
                                   aria-label="Command input"
                                   onkeydown="handleCommandInput(event)">
                            <button class="send-btn" onclick="executeGameCommand()" id="sendBtn" aria-label="Send command" title="Send command">
                                <span class="send-text">SEND</span>
                                <span class="send-icon">‚ö°</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Command Chips -->
                    <div class="quick-chips" id="quickChips">
                        <button class="command-chip" onclick="quickGameCommand('fight goblin')" data-command="fight goblin">
                            <span class="chip-icon">‚öîÔ∏è</span>
                            <span class="chip-text">Fight</span>
                        </button>
                        <button class="command-chip" onclick="quickGameCommand('explore forest')" data-command="explore forest">
                            <span class="chip-icon">üå≤</span>
                            <span class="chip-text">Explore</span>
                        </button>
                        <button class="command-chip" onclick="quickGameCommand('heal')" data-command="heal">
                            <span class="chip-icon">üß™</span>
                            <span class="chip-text">Heal</span>
                        </button>
                        <button class="command-chip" onclick="quickGameCommand('inventory')" data-command="inventory">
                            <span class="chip-icon">üéí</span>
                            <span class="chip-text">Inventory</span>
                        </button>
                        <button class="command-chip" onclick="quickGameCommand('stats')" data-command="stats">
                            <span class="chip-icon">üìä</span>
                            <span class="chip-text">Stats</span>
                        </button>
                        <button class="command-chip" onclick="quickGameCommand('rest')" data-command="rest">
                            <span class="chip-icon">üõå</span>
                            <span class="chip-text">Rest</span>
                        </button>
                    </div>
                    
                    <!-- Command History -->
                    <div class="history-section">
                        <div class="history-title">
                            <span class="history-icon">üìã</span>
                            Recent Commands
                        </div>
                        <div class="history-list" id="historyList">
                            <!-- Command history will be added here -->
                            <div class="history-placeholder">No commands yet</div>
                        </div>
                    </div>
                </div>

                <!-- Quest Section -->
                <div class="quest-section">
                    <div class="section-title">
                        <span class="section-icon">üéØ</span>
                        ACTIVE QUEST
                    </div>
                    <div class="quest-content">
                        <div class="quest-title" id="questTitle">Initiate's Trial</div>
                        <div class="quest-desc" id="questDesc">Defeat 3 enemies to prove your worth</div>
                        <div class="quest-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="questProgress" style="width: 0%"></div>
                            </div>
                            <div class="progress-text" id="questProgressText">0/3</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Footer -->
        <footer class="game-footer">
            <div class="footer-left">
                <span class="footer-text" id="deviceStatus">üì± Mobile ‚Ä¢ Online</span>
            </div>
            <div class="footer-center">
                <span class="footer-text">üéÆ Soul Commander v2.1</span>
            </div>
            <div class="footer-right">
                <button class="footer-btn" onclick="showKeyboardHelp()" title="Keyboard shortcuts" id="keyboardHelpBtn">
                    <span class="footer-icon">‚å®Ô∏è</span>
                </button>
                <button class="footer-btn" onclick="toggleGameTheme()" title="Toggle theme" id="themeToggleBtn">
                    <span class="footer-icon">üåô</span>
                </button>
                <button class="footer-btn" onclick="shareGameLink()" title="Share game" id="shareGameBtn">
                    <span class="footer-icon">üì§</span>
                </button>
            </div>
        </footer>
    </div>

    <!-- Mobile Tips Modal -->
    <div class="modal" id="mobileTipsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì± Mobile Tips</h2>
                <button class="modal-close" onclick="closeModal('mobileTipsModal')" aria-label="Close">
                    √ó
                </button>
            </div>
            <div class="modal-body">
                <div class="tip-item">
                    <span class="tip-icon">üëÜ</span>
                    <div class="tip-content">
                        <h3>Tap Equipment</h3>
                        <p>Tap equipment slots to use items quickly</p>
                    </div>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚¨ÜÔ∏è‚¨áÔ∏è</span>
                    <div class="tip-content">
                        <h3>Scroll Game Log</h3>
                        <p>Swipe up/down on game log to scroll messages</p>
                    </div>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚å®Ô∏è</span>
                    <div class="tip-content">
                        <h3>Quick Commands</h3>
                        <p>Use command chips for frequent actions</p>
                    </div>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">üíæ</span>
                    <div class="tip-content">
                        <h3>Auto-save</h3>
                        <p>Game saves automatically every 2 minutes</p>
                    </div>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">üì±</span>
                    <div class="tip-content">
                        <h3>Install as App</h3>
                        <p>Add to home screen for app-like experience</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Detection & Responsive Handler -->
    <script>
        // Responsive Layout Handler
        class ResponsiveLayout {
            constructor() {
                this.isMobile = false;
                this.isTablet = false;
                this.isDesktop = false;
                this.orientation = 'portrait';
                this.init();
            }
            
            init() {
                this.detectDevice();
                this.setupEventListeners();
                this.applyLayout();
            }
            
            detectDevice() {
                const width = window.innerWidth;
                const height = window.innerHeight;
                
                this.isMobile = width <= 768;
                this.isTablet = width > 768 && width <= 1024;
                this.isDesktop = width > 1024;
                this.orientation = width > height ? 'landscape' : 'portrait';
                
                console.log(`Device: ${this.isMobile ? 'Mobile' : this.isTablet ? 'Tablet' : 'Desktop'} (${this.orientation})`);
            }
            
            setupEventListeners() {
                window.addEventListener('resize', () => this.handleResize());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.handleResize(), 100);
                });
                
                // Touch device detection
                document.addEventListener('touchstart', () => {
                    document.body.classList.add('touch-device');
                }, { once: true });
            }
            
            handleResize() {
                this.detectDevice();
                this.applyLayout();
                
                // Dispatch custom event
                window.dispatchEvent(new CustomEvent('layoutchange', {
                    detail: {
                        isMobile: this.isMobile,
                        isTablet: this.isTablet,
                        isDesktop: this.isDesktop,
                        orientation: this.orientation
                    }
                }));
            }
            
            applyLayout() {
                const body = document.body;
                const gameContainer = document.getElementById('gameContainer');
                
                if (!gameContainer) return;
                
                // Remove all layout classes
                gameContainer.classList.remove('mobile-layout', 'tablet-layout', 'desktop-layout');
                gameContainer.classList.remove('portrait-mode', 'landscape-mode');
                
                // Add current layout class
                if (this.isMobile) {
                    gameContainer.classList.add('mobile-layout');
                    this.setupMobileLayout();
                } else if (this.isTablet) {
                    gameContainer.classList.add('tablet-layout');
                    this.setupTabletLayout();
                } else {
                    gameContainer.classList.add('desktop-layout');
                    this.setupDesktopLayout();
                }
                
                // Add orientation class
                gameContainer.classList.add(`${this.orientation}-mode`);
                
                // Update status display
                this.updateStatusDisplay();
            }
            
            setupMobileLayout() {
                // Mobile-specific adjustments
                const gameArea = document.getElementById('gameArea');
                if (gameArea) {
                    gameArea.style.flexDirection = 'column';
                }
                
                // Adjust character canvas size
                const canvas = document.getElementById('characterCanvas');
                if (canvas) {
                    canvas.width = 80;
                    canvas.height = 80;
                }
                
                // Show mobile help button
                const mobileHelpBtn = document.getElementById('mobileHelpBtn');
                if (mobileHelpBtn) {
                    mobileHelpBtn.style.display = 'flex';
                }
            }
            
            setupTabletLayout() {
                // Tablet-specific adjustments
                const gameArea = document.getElementById('gameArea');
                if (gameArea) {
                    if (this.orientation === 'portrait') {
                        gameArea.style.flexDirection = 'column';
                    } else {
                        gameArea.style.flexDirection = 'row';
                    }
                }
                
                // Adjust character canvas size
                const canvas = document.getElementById('characterCanvas');
                if (canvas) {
                    canvas.width = 100;
                    canvas.height = 100;
                }
            }
            
            setupDesktopLayout() {
                // Desktop-specific adjustments
                const gameArea = document.getElementById('gameArea');
                if (gameArea) {
                    gameArea.style.flexDirection = 'row';
                }
                
                // Adjust character canvas size
                const canvas = document.getElementById('characterCanvas');
                if (canvas) {
                    canvas.width = 128;
                    canvas.height = 128;
                }
                
                // Hide mobile help button
                const mobileHelpBtn = document.getElementById('mobileHelpBtn');
                if (mobileHelpBtn) {
                    mobileHelpBtn.style.display = 'none';
                }
            }
            
            updateStatusDisplay() {
                const deviceStatus = document.getElementById('deviceStatus');
                if (!deviceStatus) return;
                
                let statusText = '';
                if (this.isMobile) {
                    statusText = 'üì± Mobile ‚Ä¢ ';
                } else if (this.isTablet) {
                    statusText = 'üìü Tablet ‚Ä¢ ';
                } else {
                    statusText = 'üíª Desktop ‚Ä¢ ';
                }
                
                statusText += navigator.onLine ? 'Online' : 'Offline';
                deviceStatus.textContent = statusText;
            }
            
            getLayoutInfo() {
                return {
                    isMobile: this.isMobile,
                    isTablet: this.isTablet,
                    isDesktop: this.isDesktop,
                    orientation: this.orientation,
                    width: window.innerWidth,
                    height: window.innerHeight
                };
            }
        }
        
        // Initialize responsive layout
        let responsiveLayout = null;
        
        // Game Initialization
        function initializeGame() {
            // Initialize responsive layout
            responsiveLayout = new ResponsiveLayout();
            
            // Setup service worker for PWA
            setupServiceWorker();
            
            // Setup game event listeners
            setupGameEvents();
            
            // Start loading screen
            startLoadingScreen();
        }
        
        function setupServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => {
                        console.log('‚úÖ Service Worker registered');
                        updateOnlineStatus();
                    })
                    .catch(err => console.log('‚ùå Service Worker failed:', err));
            }
        }
        
        function setupGameEvents() {
            // Online/offline detection
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            
            // Visibility change for auto-save
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    // Game is hidden, could trigger auto-save
                    console.log('Game hidden');
                }
            });
            
            // Prevent context menu on game elements
            document.addEventListener('contextmenu', (e) => {
                if (e.target.classList.contains('command-chip') || 
                    e.target.classList.contains('equip-slot')) {
                    e.preventDefault();
                }
            });
        }
        
        function updateOnlineStatus() {
            const onlineStatus = document.getElementById('onlineStatus');
            const connectionText = document.getElementById('connectionText');
            
            if (onlineStatus && connectionText) {
                if (navigator.onLine) {
                    connectionText.textContent = 'Online';
                    onlineStatus.style.color = '#55EFC4';
                } else {
                    connectionText.textContent = 'Offline';
                    onlineStatus.style.color = '#FF7675';
                }
            }
        }
        
        function startLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingBar = document.getElementById('loadingBar');
            const loadingTip = document.getElementById('loadingTip');
            const gameContainer = document.getElementById('gameContainer');
            
            if (!loadingScreen) return;
            
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 25;
                if (progress > 100) progress = 100;
                
                if (loadingBar) {
                    loadingBar.style.width = `${progress}%`;
                }
                
                const tips = [
                    "Initializing soul engine...",
                    "Loading pixel realms...",
                    "Optimizing for your device...",
                    "Preparing command system...",
                    "Almost ready for adventure..."
                ];
                
                if (loadingTip && progress % 20 < 5) {
                    const tipIndex = Math.floor(progress / 20);
                    loadingTip.textContent = tips[tipIndex] || tips[tips.length - 1];
                }
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    
                    // Fade out loading screen
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        
                        // Show game container
                        if (gameContainer) {
                            gameContainer.style.display = 'flex';
                            setTimeout(() => {
                                gameContainer.style.opacity = '1';
                                
                                // Focus command input
                                const commandInput = document.getElementById('commandInput');
                                if (commandInput) {
                                    setTimeout(() => commandInput.focus(), 300);
                                }
                                
                                // Initialize main game
                                initializeMainGame();
                                
                            }, 100);
                        }
                        
                    }, 500);
                }
            }, 150);
        }
        
        function initializeMainGame() {
            // Initialize game logic here
            console.log('Main game initialized');
            
            // Update initial time in log
            updateLogTime();
            
            // Setup command input handling
            setupCommandInput();
            
            // Draw initial character
            drawInitialCharacter();
            
            // Start game loop
            startGameLoop();
        }
        
        function updateLogTime() {
            const now = new Date();
            const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}]`;
            
            const logTimeElements = document.querySelectorAll('.log-time');
            logTimeElements.forEach(el => {
                if (el.textContent === '[00:00]') {
                    el.textContent = timeString;
                }
            });
        }
        
        function setupCommandInput() {
            const commandInput = document.getElementById('commandInput');
            if (!commandInput) return;
            
            commandInput.addEventListener('input', handleCommandSuggestions);
            commandInput.addEventListener('focus', () => {
                document.body.classList.add('keyboard-active');
            });
            commandInput.addEventListener('blur', () => {
                document.body.classList.remove('keyboard-active');
            });
        }
        
        function handleCommandInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                executeGameCommand();
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                navigateCommandHistory(-1);
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                navigateCommandHistory(1);
            } else if (event.key === 'Tab') {
                event.preventDefault();
                autoCompleteCommand();
            }
        }
        
        function handleCommandSuggestions(event) {
            const input = event.target.value.toLowerCase();
            const chips = document.querySelectorAll('.command-chip');
            
            chips.forEach(chip => {
                const command = chip.getAttribute('data-command') || chip.textContent.toLowerCase();
                if (input && command.includes(input)) {
                    chip.style.opacity = '1';
                    chip.style.transform = 'scale(1)';
                } else if (input) {
                    chip.style.opacity = '0.5';
                    chip.style.transform = 'scale(0.95)';
                } else {
                    chip.style.opacity = '1';
                    chip.style.transform = 'scale(1)';
                }
            });
        }
        
        function executeGameCommand() {
            const commandInput = document.getElementById('commandInput');
            const command = commandInput.value.trim();
            
            if (!command) {
                // Show empty input feedback
                commandInput.style.borderColor = '#FF7675';
                setTimeout(() => {
                    commandInput.style.borderColor = '';
                }, 500);
                return;
            }
            
            // Clear input
            commandInput.value = '';
            
            // Add to history
            addToCommandHistory(command);
            
            // Process command
            processGameCommand(command);
            
            // Focus back on input
            setTimeout(() => commandInput.focus(), 100);
        }
        
        function quickGameCommand(command) {
            const commandInput = document.getElementById('commandInput');
            commandInput.value = command;
            executeGameCommand();
        }
        
        function addToCommandHistory(command) {
            const historyList = document.getElementById('historyList');
            const placeholder = historyList.querySelector('.history-placeholder');
            
            if (placeholder) {
                placeholder.remove();
            }
            
            // Create history item
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.textContent = command;
            historyItem.onclick = () => {
                document.getElementById('commandInput').value = command;
                document.getElementById('commandInput').focus();
            };
            
            // Add to beginning of list
            historyList.insertBefore(historyItem, historyList.firstChild);
            
            // Keep only 5 items
            const items = historyList.querySelectorAll('.history-item');
            if (items.length > 5) {
                items[5].remove();
            }
        }
        
        function navigateCommandHistory(direction) {
            // Implementation for command history navigation
            console.log('Navigate history:', direction);
        }
        
        function autoCompleteCommand() {
            const commandInput = document.getElementById('commandInput');
            const current = commandInput.value.toLowerCase().trim();
            
            if (!current) {
                showCommandSuggestions();
                return;
            }
            
            // Simple auto-complete logic
            const commonCommands = ['fight', 'explore', 'heal', 'inventory', 'stats', 'rest', 'save', 'load'];
            const matches = commonCommands.filter(cmd => cmd.startsWith(current));
            
            if (matches.length === 1) {
                commandInput.value = matches[0];
            } else if (matches.length > 1) {
                addGameLog(`üîç Matching commands: ${matches.slice(0, 3).join(', ')}`, 'system');
            }
            
            commandInput.focus();
        }
        
        function showCommandSuggestions() {
            addGameLog('üìã Quick commands:', 'system');
            addGameLog('‚öîÔ∏è fight [enemy] - Battle an enemy', 'system');
            addGameLog('üå≤ explore [area] - Explore locations', 'system');
            addGameLog('üß™ heal - Use health potion', 'system');
            addGameLog('üéí inventory - Show inventory', 'system');
            addGameLog('üìä stats - Show player stats', 'system');
            addGameLog('üõå rest - Rest to recover', 'system');
            addGameLog('üí° Type "help" for more commands', 'system');
        }
        
        function processGameCommand(command) {
            // Add command to log
            addGameLog(`> ${command}`, 'system');
            
            // Process different commands
            const cmd = command.toLowerCase().split(' ')[0];
            const args = command.toLowerCase().split(' ').slice(1);
            
            switch(cmd) {
                case 'fight':
                case 'attack':
                case 'battle':
                    handleCombatCommand(args);
                    break;
                case 'explore':
                case 'travel':
                    handleExploreCommand(args);
                    break;
                case 'heal':
                case 'potion':
                    handleHealCommand();
                    break;
                case 'inventory':
                case 'inv':
                    showInventory();
                    break;
                case 'stats':
                case 'status':
                    showPlayerStats();
                    break;
                case 'rest':
                case 'sleep':
                    handleRestCommand();
                    break;
                case 'save':
                    gameSave();
                    break;
                case 'load':
                    gameLoad();
                    break;
                case 'clear':
                    clearGameLog();
                    break;
                case 'help':
                case '?':
                    showGameHelp();
                    break;
                default:
                    addGameLog(`‚ùì Unknown command: "${cmd}"`, 'system');
                    addGameLog('üí° Type "help" for available commands', 'system');
            }
        }
        
        function handleCombatCommand(args) {
            const enemy = args[0] || 'goblin';
            addGameLog(`‚öîÔ∏è Preparing to fight ${enemy}...`, 'combat');
            
            // Simulate combat
            setTimeout(() => {
                const damage = Math.floor(Math.random() * 20) + 10;
                const enemyDamage = Math.floor(Math.random() * 15) + 5;
                
                addGameLog(`üéØ You deal ${damage} damage to ${enemy}!`, 'combat');
                addGameLog(`üíÄ ${enemy} hits you for ${enemyDamage} damage!`, 'combat');
                
                // Update health
                updateHealth(-enemyDamage);
                
                // 50% chance to defeat enemy
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        addGameLog(`üèÜ ${enemy.charAt(0).toUpperCase() + enemy.slice(1)} defeated!`, 'combat');
                        addGameLog(`üí∞ +${Math.floor(Math.random() * 30) + 10} Gold`, 'loot');
                        addGameLog(`‚≠ê +${Math.floor(Math.random() * 25) + 15} XP`, 'xp');
                        
                        // Update stats
                        updateGold(Math.floor(Math.random() * 30) + 10);
                        updateKills(1);
                        updateXP(Math.floor(Math.random() * 25) + 15);
                    }, 500);
                }
            }, 800);
        }
        
        function handleExploreCommand(args) {
            const area = args[0] || 'forest';
            addGameLog(`üå≤ Exploring ${area}...`, 'system');
            
            setTimeout(() => {
                const events = [
                    `You find a hidden treasure chest!`,
                    `A mysterious stranger offers you a quest.`,
                    `You discover ancient ruins.`,
                    `Wild animals scatter as you approach.`,
                    `You find a beautiful view overlooking the valley.`
                ];
                
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                addGameLog(`üìç ${randomEvent}`, 'system');
                
                // Chance for combat
                if (Math.random() > 0.7) {
                    setTimeout(() => {
                        addGameLog(`‚ö†Ô∏è Ambushed by wild creatures!`, 'combat');
                        addGameLog(`üí° Type 'fight' to defend yourself`, 'system');
                    }, 1000);
                }
            }, 1000);
        }
        
        function handleHealCommand() {
            const potionCount = parseInt(document.getElementById('potionName').textContent) || 0;
            
            if (potionCount <= 0) {
                addGameLog(`‚ùå No potions available!`, 'system');
                return;
            }
            
            // Use potion
            const newPotionCount = potionCount - 1;
            document.getElementById('potionName').textContent = `${newPotionCount}x`;
            
            // Heal player
            const healAmount = 30;
            updateHealth(healAmount);
            
            addGameLog(`üß™ Used Health Potion!`, 'heal');
            addGameLog(`‚ù§Ô∏è +${healAmount} Health`, 'heal');
            addGameLog(`üì¶ Potions remaining: ${newPotionCount}`, 'heal');
            
            // Visual feedback
            const healthBar = document.getElementById('healthBar');
            if (healthBar) {
                healthBar.style.boxShadow = '0 0 15px #FF7675';
                setTimeout(() => {
                    healthBar.style.boxShadow = '';
                }, 1000);
            }
        }
        
        function handleRestCommand() {
            addGameLog(`üõå You take a moment to rest...`, 'system');
            
            setTimeout(() => {
                const healthRecover = 20;
                const manaRecover = 30;
                
                updateHealth(healthRecover);
                updateMana(manaRecover);
                
                addGameLog(`‚ù§Ô∏è +${healthRecover} Health`, 'heal');
                addGameLog(`üîÆ +${manaRecover} Mana`, 'heal');
                addGameLog(`üìÖ A new day begins...`, 'system');
                
                // Update game day
                const dayElement = document.getElementById('gameDayValue');
                if (dayElement) {
                    const currentDay = parseInt(dayElement.textContent) || 1;
                    dayElement.textContent = currentDay + 1;
                }
            }, 1000);
        }
        
        function showInventory() {
            addGameLog('üéí === INVENTORY ===', 'system');
            addGameLog('‚öîÔ∏è Iron Sword x1', 'system');
            addGameLog('üõ°Ô∏è Leather Armor x1', 'system');
            addGameLog('üß™ Health Potion x3', 'system');
            addGameLog('üîÆ Mana Potion x2', 'system');
            addGameLog('üí∞ Gold: 1,250', 'system');
            addGameLog('üí° Use "use [item]" or tap equipment slots', 'system');
        }
        
        function showPlayerStats() {
            addGameLog('üìä === PLAYER STATS ===', 'system');
            addGameLog('üë§ Name: Knight', 'system');
            addGameLog('üé≠ Class: Warrior', 'system');
            addGameLog('‚≠ê Level: 1', 'system');
            addGameLog('‚ù§Ô∏è Health: 100/100', 'system');
            addGameLog('üîÆ Mana: 50/50', 'system');
            addGameLog('üí∞ Gold: 1,250', 'system');
            addGameLog('üéØ Kills: 0', 'system');
            addGameLog('üìç Location: Sanctuary', 'system');
            addGameLog('üìÖ Day: 1', 'system');
        }
        
        function updateHealth(amount) {
            const healthValue = document.getElementById('healthValue');
            const healthBar = document.getElementById('healthBar');
            
            if (!healthValue || !healthBar) return;
            
            const current = healthValue.textContent.split('/');
            let currentHealth = parseInt(current[0]) || 100;
            const maxHealth = parseInt(current[1]) || 100;
            
            currentHealth = Math.max(0, Math.min(maxHealth, currentHealth + amount));
            
            healthValue.textContent = `${currentHealth}/${maxHealth}`;
            const percent = (currentHealth / maxHealth) * 100;
            healthBar.style.width = `${percent}%`;
            
            // Update bar color based on health
            if (percent < 30) {
                healthBar.style.background = 'linear-gradient(90deg, #FF7675, #FF4757)';
            } else if (percent < 60) {
                healthBar.style.background = 'linear-gradient(90deg, #FFEAA7, #FDCB6E)';
            } else {
                healthBar.style.background = 'linear-gradient(90deg, var(--accent-red), #FF4757)';
            }
        }
        
        function updateMana(amount) {
            const manaValue = document.getElementById('manaValue');
            const manaBar = document.getElementById('manaBar');
            
            if (!manaValue || !manaBar) return;
            
            const current = manaValue.textContent.split('/');
            let currentMana = parseInt(current[0]) || 50;
            const maxMana = parseInt(current[1]) || 50;
            
            currentMana = Math.max(0, Math.min(maxMana, currentMana + amount));
            
            manaValue.textContent = `${currentMana}/${maxMana}`;
            const percent = (currentMana / maxMana) * 100;
            manaBar.style.width = `${percent}%`;
        }
        
        function updateGold(amount) {
            const goldElement = document.getElementById('goldValue');
            if (!goldElement) return;
            
            const currentGold = parseInt(goldElement.textContent.replace(/,/g, '')) || 1250;
            const newGold = currentGold + amount;
            
            goldElement.textContent = newGold.toLocaleString();
        }
        
        function updateKills(amount) {
            const killsElement = document.getElementById('killsValue');
            if (!killsElement) return;
            
            const currentKills = parseInt(killsElement.textContent) || 0;
            killsElement.textContent = currentKills + amount;
        }
        
        function updateXP(amount) {
            const xpValue = document.getElementById('xpValue');
            const xpBar = document.getElementById('xpBar');
            
            if (!xpValue || !xpBar) return;
            
            const current = xpValue.textContent.split('/');
            let currentXP = parseInt(current[0]) || 0;
            const xpToNext = parseInt(current[1]) || 100;
            
            currentXP = currentXP + amount;
            
            // Check for level up
            if (currentXP >= xpToNext) {
                levelUp();
                currentXP = currentXP - xpToNext;
            }
            
            xpValue.textContent = `${currentXP}/${xpToNext}`;
            const percent = (currentXP / xpToNext) * 100;
            xpBar.style.width = `${percent}%`;
        }
        
        function levelUp() {
            const levelElement = document.getElementById('charLevel');
            if (!levelElement) return;
            
            const currentLevel = parseInt(levelElement.textContent) || 1;
            levelElement.textContent = currentLevel + 1;
            
            addGameLog(`‚ú® LEVEL UP! You are now Level ${currentLevel + 1}!`, 'xp');
            addGameLog(`‚ù§Ô∏è Max Health increased!`, 'heal');
            addGameLog(`üîÆ Max Mana increased!`, 'heal');
            
            // Update max stats
            const healthValue = document.getElementById('healthValue');
            const manaValue = document.getElementById('manaValue');
            
            if (healthValue) {
                const current = healthValue.textContent.split('/');
                const newMax = parseInt(current[1]) + 20;
                healthValue.textContent = `${newMax}/${newMax}`;
                document.getElementById('healthBar').style.width = '100%';
            }
            
            if (manaValue) {
                const current = manaValue.textContent.split('/');
                const newMax = parseInt(current[1]) + 10;
                manaValue.textContent = `${newMax}/${newMax}`;
                document.getElementById('manaBar').style.width = '100%';
            }
            
            // Visual effect
            const canvas = document.getElementById('characterCanvas');
            if (canvas) {
                canvas.style.boxShadow = '0 0 30px #FFEAA7';
                setTimeout(() => {
                    canvas.style.boxShadow = '';
                }, 1000);
            }
        }
        
        function addGameLog(message, type = 'system') {
            const gameLog = document.getElementById('gameLog');
            if (!gameLog) return;
            
            const now = new Date();
            const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}]`;
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `
                <span class="log-time">${timeString}</span>
                <span class="log-content">${message}</span>
            `;
            
            gameLog.appendChild(logEntry);
            
            // Update counter
            updateLogCounter();
            
            // Auto-scroll if enabled
            if (isAutoScrollEnabled()) {
                setTimeout(() => {
                    gameLog.scrollTop = gameLog.scrollHeight;
                }, 50);
            }
            
            // Keep only last 50 messages
            const entries = gameLog.querySelectorAll('.log-entry');
            if (entries.length > 50) {
                entries[0].remove();
            }
        }
        
        function updateLogCounter() {
            const counter = document.getElementById('logCounter');
            const gameLog = document.getElementById('gameLog');
            
            if (!counter || !gameLog) return;
            
            const entries = gameLog.querySelectorAll('.log-entry').length;
            counter.textContent = `${entries}/100 messages`;
            
            // Warning color if almost full
            if (entries > 80) {
                counter.style.color = '#FF7675';
            }
        }
        
        function isAutoScrollEnabled() {
            const autoScrollBtn = document.getElementById('autoScrollBtn');
            return autoScrollBtn && autoScrollBtn.textContent.includes('üîΩ');
        }
        
        function toggleLogAutoScroll() {
            const autoScrollBtn = document.getElementById('autoScrollBtn');
            const logHint = document.getElementById('logHint');
            
            if (!autoScrollBtn || !logHint) return;
            
            if (isAutoScrollEnabled()) {
                // Disable auto-scroll
                autoScrollBtn.textContent = '‚è∏Ô∏è';
                autoScrollBtn.title = 'Auto-scroll OFF';
                logHint.textContent = '‚è∏Ô∏è Auto-scroll OFF ‚Ä¢ Scroll manually';
            } else {
                // Enable auto-scroll
                autoScrollBtn.textContent = 'üîΩ';
                autoScrollBtn.title = 'Auto-scroll ON';
                logHint.textContent = '‚Üì Auto-scroll ON ‚Ä¢ Tap log to focus input';
                
                // Scroll to bottom
                const gameLog = document.getElementById('gameLog');
                if (gameLog) {
                    gameLog.scrollTop = gameLog.scrollHeight;
                }
            }
        }
        
        function scrollLogToTop() {
            const gameLog = document.getElementById('gameLog');
            if (gameLog) {
                gameLog.scrollTop = 0;
            }
        }
        
        function clearGameLog() {
            const gameLog = document.getElementById('gameLog');
            if (!gameLog) return;
            
            // Keep only the first 4 default messages
            const entries = gameLog.querySelectorAll('.log-entry');
            for (let i = 4; i < entries.length; i++) {
                entries[i].remove();
            }
            
            addGameLog('üóëÔ∏è Game log cleared', 'system');
            updateLogCounter();
        }
        
        function useEquipmentItem(slot) {
            const messages = {
                weapon: '‚öîÔ∏è You prepare your weapon for battle...',
                skill: 'üí• Charging special skill...',
                armor: 'üõ°Ô∏è Your armor is securely equipped.',
                accessory: 'üíé Artifact power activated!',
                potion: handleHealCommand(), // This will call the heal function
                special: 'üêâ Your companion is ready to assist!'
            };
            
            if (slot !== 'potion') {
                addGameLog(messages[slot] || `Using ${slot}...`, 'system');
            }
            
            // Visual feedback
            const slotElement = document.querySelector(`[data-slot="${slot}"]`);
            if (slotElement) {
                slotElement.style.transform = 'scale(0.95)';
                slotElement.style.boxShadow = '0 0 15px var(--primary-purple)';
                setTimeout(() => {
                    slotElement.style.transform = '';
                    slotElement.style.boxShadow = '';
                }, 300);
            }
        }
        
        function drawInitialCharacter() {
            const canvas = document.getElementById('characterCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw simple character
            ctx.fillStyle = '#6C5CE7';
            ctx.fillRect(canvas.width * 0.25, canvas.height * 0.4, canvas.width * 0.5, canvas.height * 0.3);
            
            // Head
            ctx.fillStyle = '#FFEAA7';
            ctx.fillRect(canvas.width * 0.35, canvas.height * 0.2, canvas.width * 0.3, canvas.height * 0.25);
            
            // Eyes
            ctx.fillStyle = '#2D3436';
            ctx.fillRect(canvas.width * 0.4, canvas.height * 0.3, canvas.width * 0.05, canvas.height * 0.05);
            ctx.fillRect(canvas.width * 0.55, canvas.height * 0.3, canvas.width * 0.05, canvas.height * 0.05);
            
            // Weapon
            ctx.fillStyle = '#B2BEC3';
            ctx.fillRect(canvas.width * 0.1, canvas.height * 0.45, canvas.width * 0.15, canvas.height * 0.05);
            ctx.fillRect(canvas.width * 0.05, canvas.height * 0.35, canvas.width * 0.25, canvas.height * 0.2);
        }
        
        function startGameLoop() {
            let lastTime = 0;
            
            function animate(time) {
                const delta = time - lastTime;
                lastTime = time;
                
                // Update character animation
                updateCharacterAnimation(delta);
                
                // Continue animation loop
                requestAnimationFrame(animate);
            }
            
            requestAnimationFrame(animate);
        }
        
        function updateCharacterAnimation(delta) {
            const canvas = document.getElementById('characterCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const time = Date.now() / 1000;
            
            // Gentle floating animation
            const floatOffset = Math.sin(time) * 1.5;
            
            // Clear and redraw with offset
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(0, floatOffset);
            drawInitialCharacter();
            ctx.restore();
        }
        
        // UI Control Functions
        function toggleGameMenu() {
            const menu = document.getElementById('gameMenu');
            if (menu) {
                menu.classList.toggle('show');
                
                // Close menu when clicking outside
                if (menu.classList.contains('show')) {
                    setTimeout(() => {
                        document.addEventListener('click', closeMenuOnClickOutside);
                    }, 10);
                }
            }
        }
        
        function closeMenuOnClickOutside(event) {
            const menu = document.getElementById('gameMenu');
            const menuBtn = document.getElementById('menuBtn');
            
            if (menu && menuBtn && !menu.contains(event.target) && !menuBtn.contains(event.target)) {
                menu.classList.remove('show');
                document.removeEventListener('click', closeMenuOnClickOutside);
            }
        }
        
        function toggleGameSound() {
            const soundBtn = document.getElementById('soundToggleBtn');
            if (!soundBtn) return;
            
            const icon = soundBtn.querySelector('.menu-icon');
            const text = soundBtn.textContent;
            
            if (text.includes('ON')) {
                soundBtn.innerHTML = '<span class="menu-icon">üîá</span> Sound: OFF';
                addGameLog('üîá Sound disabled', 'system');
            } else {
                soundBtn.innerHTML = '<span class="menu-icon">üîä</span> Sound: ON';
                addGameLog('üîä Sound enabled', 'system');
            }
        }
        
        function toggleGameTheme() {
            const themeBtn = document.getElementById('themeToggleBtn');
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            
            if (themeBtn) {
                themeBtn.innerHTML = `<span class="footer-icon">${newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è'}</span>`;
            }
            
            addGameLog(`üé® Theme: ${newTheme}`, 'system');
            
            // Save theme preference
            localStorage.setItem('soul_commander_theme', newTheme);
        }
        
        function toggleFullscreenMode() {
            const elem = document.documentElement;
            
            if (!document.fullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                }
                addGameLog('‚õ∂ Entered fullscreen mode', 'system');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
                addGameLog('üì± Exited fullscreen mode', 'system');
            }
        }
        
        function showMobileTipsModal() {
            const modal = document.getElementById('mobileTipsModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        function showKeyboardHelp() {
            addGameLog('‚å®Ô∏è === KEYBOARD SHORTCUTS ===', 'system');
            addGameLog('Enter - Execute command', 'system');
            addGameLog('‚Üë/‚Üì - Navigate command history', 'system');
            addGameLog('Tab - Auto-complete command', 'system');
            addGameLog('Esc - Blur input field', 'system');
        }
        
        function showGameHelp() {
            addGameLog('‚ùì === SOUL COMMANDER HELP ===', 'system');
            addGameLog('=== BASIC COMMANDS ===', 'system');
            addGameLog('fight [enemy] - Battle an enemy', 'system');
            addGameLog('explore [area] - Explore locations', 'system');
            addGameLog('heal - Use health potion', 'system');
            addGameLog('rest - Rest to recover health/mana', 'system');
            addGameLog('inventory - View inventory', 'system');
            addGameLog('stats - View player statistics', 'system');
            addGameLog('=== ADVANCED COMMANDS ===', 'system');
            addGameLog('save - Save your game progress', 'system');
            addGameLog('load - Load saved game', 'system');
            addGameLog('clear - Clear game log', 'system');
            addGameLog('=== MOBILE CONTROLS ===', 'system');
            addGameLog('‚Ä¢ Tap equipment slots to use items', 'system');
            addGameLog('‚Ä¢ Use command chips for quick actions', 'system');
            addGameLog('‚Ä¢ Swipe game log to scroll messages', 'system');
        }
        
        function gameSave() {
            addGameLog('üíæ Game saved successfully!', 'system');
            // In a real implementation, save to localStorage
            localStorage.setItem('soul_commander_save', JSON.stringify({
                timestamp: Date.now(),
                message: 'Game saved'
            }));
        }
        
        function gameLoad() {
            const saveData = localStorage.getItem('soul_commander_save');
            if (saveData) {
                addGameLog('üìÇ Game loaded successfully!', 'system');
            } else {
                addGameLog('‚ùå No saved game found', 'system');
            }
        }
        
        function exportGameData() {
            addGameLog('üì§ Exporting game data...', 'system');
            // Simulate export
            setTimeout(() => {
                addGameLog('‚úÖ Game data exported to clipboard', 'system');
            }, 500);
        }
        
        function resetGameData() {
            if (confirm('Reset game? All progress will be lost!')) {
                addGameLog('üîÑ Game reset successfully!', 'system');
                addGameLog('üåü New adventure begins...', 'system');
                
                // Reset stats
                document.getElementById('charLevel').textContent = '1';
                document.getElementById('healthValue').textContent = '100/100';
                document.getElementById('healthBar').style.width = '100%';
                document.getElementById('manaValue').textContent = '50/50';
                document.getElementById('manaBar').style.width = '100%';
                document.getElementById('xpValue').textContent = '0/100';
                document.getElementById('xpBar').style.width = '0%';
                document.getElementById('goldValue').textContent = '1,250';
                document.getElementById('killsValue').textContent = '0';
                document.getElementById('gameDayValue').textContent = '1';
                document.getElementById('potionName').textContent = '3x';
                
                // Clear command history
                const historyList = document.getElementById('historyList');
                if (historyList) {
                    historyList.innerHTML = '<div class="history-placeholder">No commands yet</div>';
                }
                
                // Reset to default messages
                clearGameLog();
                addGameLog('üåü WELCOME TO SOUL COMMANDER v2.1! üåü', 'welcome');
                addGameLog('‚öîÔ∏è Your journey begins in the Sanctuary...', 'system');
                addGameLog('üì± Mobile optimized ‚Ä¢ PWA ready ‚Ä¢ Offline play', 'system');
                addGameLog('üí° Type commands or use quick actions below', 'system');
            }
        }
        
        function shareGameLink() {
            if (navigator.share) {
                navigator.share({
                    title: 'Soul Commander',
                    text: 'Check out this awesome pixel command RPG game!',
                    url: window.location.href
                });
            } else {
                // Fallback for browsers without Web Share API
                navigator.clipboard.writeText(window.location.href)
                    .then(() => {
                        addGameLog('üìã Game link copied to clipboard!', 'system');
                    })
                    .catch(() => {
                        alert('Game URL: ' + window.location.href);
                    });
            }
        }
        
        // Load saved theme
        const savedTheme = localStorage.getItem('soul_commander_theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeGame);
        
        // PWA installation prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            // You can save the event and show an install button later
            console.log('PWA installation available');
        });
    </script>
</body>
</html>